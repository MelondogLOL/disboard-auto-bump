function redirect(requestDetails) {
      return {
        redirectUrl: "data:application/javascript;base64,InVzZSBzdHJpY3QiOw0KJChmdW5jdGlvbigpIHsNCiAgKHdpbmRvdy5kaXNib2FyZCA9IHt9KSwgcHJlcGFyZU5hdmJhcigpLCBwcmVwYXJlRHJvcGRvd24oKSwgbW9kYWwoKTsNCn0pLA0KICAod2luZG93LnByZXBhcmVNdXRlU2VydmVyID0gZnVuY3Rpb24obywgbikgew0KICAgIGlmICh3aW5kb3cuZGlzYm9hcmQubXV0ZVNlcnZlclByZXBhcmVkKSByZXR1cm4gITE7DQogICAgKHdpbmRvdy5kaXNib2FyZC5tdXRlU2VydmVyUHJlcGFyZWQgPSAhMCksDQogICAgICAobiA9IG4gfHwgIlVubXV0ZSIpLA0KICAgICAgJCgiLmJ1dHRvbi1tdXRlLXNlcnZlciIpLmNsaWNrKGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB2YXIgYSA9ICQodGhpcykuYXR0cigiZGF0YS1zZXJ2ZXItaWQiKSwNCiAgICAgICAgICB0ID0gbyArICIvIiArIGE7DQogICAgICAgICQucG9zdCh0KQ0KICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIHZhciB0ID0gJCgiLnNlcnZlci0iICsgYSk7DQogICAgICAgICAgICBlLnJlc3VsdCAmJg0KICAgICAgICAgICAgICAobm90aWUuYWxlcnQoeyB0eXBlOiAic3VjY2VzcyIsIHRleHQ6IGUubWVzc2FnZSB9KSwNCiAgICAgICAgICAgICAgdC5odG1sKA0KICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJtdXRlZC1zdWNjZXNzZnVsbHkgaGFzLXRleHQtY2VudGVyZWQiPjxidXR0b24gY2xhc3M9ImJ1dHRvbiBpcy1kYXJrIGJ1dHRvbi11bm11dGUtc2VydmVyIiBkYXRhLXNlcnZlci1pZD0iJyArDQogICAgICAgICAgICAgICAgICBhICsNCiAgICAgICAgICAgICAgICAgICciPicgKw0KICAgICAgICAgICAgICAgICAgbiArDQogICAgICAgICAgICAgICAgICAiPC9idXR0b24+PC9kaXY+Ig0KICAgICAgICAgICAgICApKTsNCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIG5vdGllLmFsZXJ0KHsgdHlwZTogImVycm9yIiwgdGV4dDogZS5yZXNwb25zZUpTT04ubWVzc2FnZSB9KTsNCiAgICAgICAgICB9KTsNCiAgICAgIH0pLA0KICAgICAgJChkb2N1bWVudCkub24oImNsaWNrIiwgIi5idXR0b24tdW5tdXRlLXNlcnZlciIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgdmFyIHQgPSAkKHRoaXMpLA0KICAgICAgICAgIGEgPSB0LmF0dHIoImRhdGEtc2VydmVyLWlkIiksDQogICAgICAgICAgbiA9IG8gKyAiLyIgKyBhICsgIj91bm11dGU9MSI7DQogICAgICAgICQucG9zdChuLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgdC5oaWRlKCksIG5vdGllLmFsZXJ0KHsgdHlwZTogInN1Y2Nlc3MiLCB0ZXh0OiBlLm1lc3NhZ2UgfSk7DQogICAgICAgIH0pOw0KICAgICAgfSk7DQogIH0pLA0KICAod2luZG93LnByZXBhcmVOYXZiYXIgPSBmdW5jdGlvbigpIHsNCiAgICBpZiAod2luZG93LmRpc2JvYXJkLm5hdmJhclByZXBhcmVkKSByZXR1cm4gITE7DQogICAgd2luZG93LmRpc2JvYXJkLm5hdmJhclByZXBhcmVkID0gITA7DQogICAgZnVuY3Rpb24gZShlKSB7DQogICAgICB2YXIgdCA9ICQoZSkuc2Nyb2xsVG9wKCkgLyAxMDA7DQogICAgICAkKCIjaGVhZGVyOm5vdCguaGFzLW1lbnUtb3BlbmVkKSIpLmNzcyh7DQogICAgICAgIGJhY2tncm91bmQ6ICJyZ2JhKDU0LCA2MiwgODksIiArIHQgKyAiKSIsDQogICAgICAgICJiYWNrZHJvcC1maWx0ZXIiOiAiYmx1cigiICsgdCArICJweCkiDQogICAgICB9KTsNCiAgICB9DQogICAgJChkb2N1bWVudCkNCiAgICAgIC5zY3JvbGwoZnVuY3Rpb24oKSB7DQogICAgICAgIGUodGhpcyk7DQogICAgICB9KQ0KICAgICAgLnJlYWR5KGZ1bmN0aW9uKCkgew0KICAgICAgICBlKHRoaXMpOw0KICAgICAgfSksDQogICAgICAkKCIubmF2YmFyLWJ1cmdlciIpLmNsaWNrKGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKSwNCiAgICAgICAgICAkKCIubmF2YmFyIikudG9nZ2xlQ2xhc3MoImhhcy1tZW51LW9wZW5lZCIpLA0KICAgICAgICAgICQoIi5uYXZiYXItbWVudSIpLnRvZ2dsZUNsYXNzKCJpcy1hY3RpdmUiKTsNCiAgICAgIH0pLA0KICAgICAgJCgiLm5hdmJhci1tZW51IikuY2xpY2soZnVuY3Rpb24oZSkgew0KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgfSksDQogICAgICAkKCJodG1sIikuY2xpY2soZnVuY3Rpb24oKSB7DQogICAgICAgICQoIi5uYXZiYXIiKS5yZW1vdmVDbGFzcygiaGFzLW1lbnUtb3BlbmVkIiksDQogICAgICAgICAgJCgiLm5hdmJhci1tZW51IikucmVtb3ZlQ2xhc3MoImlzLWFjdGl2ZSIpOw0KICAgICAgfSk7DQogIH0pOw0KdmFyIG1vZGFsID0gZnVuY3Rpb24oKSB7DQogICQoIi5idXR0b24tbW9kYWwiKS5jbGljayhmdW5jdGlvbigpIHsNCiAgICB2YXIgZSA9ICQodGhpcykuZGF0YSgidGFyZ2V0Iik7DQogICAgJChlKS5hZGRDbGFzcygiaXMtYWN0aXZlIik7DQogIH0pLA0KICAgICQoIi5tb2RhbC1jbG9zZSwgLm1vZGFsLWJhY2tncm91bmQsIC5tb2RhbCAuYnV0dG9uIikNCiAgICAgIC5ub3QoIi5idXR0b25bdHlwZT1zdWJtaXRdIikNCiAgICAgIC5jbGljayhmdW5jdGlvbigpIHsNCiAgICAgICAgJCgiLm1vZGFsIikucmVtb3ZlQ2xhc3MoImlzLWFjdGl2ZSIpOw0KICAgICAgfSk7DQp9Ow0KKHdpbmRvdy5wcmVwYXJlRHJvcGRvd24gPSBmdW5jdGlvbigpIHsNCiAgJChkb2N1bWVudCkuY2xpY2soZnVuY3Rpb24oKSB7DQogICAgJCgiLmRyb3Bkb3duIikucmVtb3ZlQ2xhc3MoImlzLWFjdGl2ZSIpOw0KICB9KSwNCiAgICAkKCIubGlzdGluZy1jYXJkIikub24oIm1vdXNlbGVhdmUiLCBmdW5jdGlvbihlKSB7DQogICAgICAkKHRoaXMpDQogICAgICAgIC5maW5kKCIuZHJvcGRvd24iKQ0KICAgICAgICAucmVtb3ZlQ2xhc3MoImlzLWFjdGl2ZSIpOw0KICAgIH0pLA0KICAgICQoIi5kcm9wZG93bjpub3QoLmlzLWhvdmVyYWJsZSkiKS5jbGljayhmdW5jdGlvbihlKSB7DQogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpLCAkKHRoaXMpLnRvZ2dsZUNsYXNzKCJpcy1hY3RpdmUiKTsNCiAgICB9KTsNCn0pLA0KICAod2luZG93LnByZXBhcmVFbGFzdGljVGV4dCA9IGZ1bmN0aW9uKCkgew0KICAgIGlmICh3aW5kb3cuZGlzYm9hcmQuZWxhc3RpY1RleHRQcmVwYXJlZCkgcmV0dXJuICExOw0KICAgIHdpbmRvdy5kaXNib2FyZC5lbGFzdGljVGV4dFByZXBhcmVkID0gITA7DQogICAgZm9yICh2YXIgZSA9ICQoIi5pcy1lbGFzdGljLXRleHQiKSwgdCA9IDAsIGEgPSBlLmxlbmd0aDsgdCA8IGE7IHQrKykgew0KICAgICAgdmFyIG4gPSAkKGVbdF0pLA0KICAgICAgICBvID0gbi5oZWlnaHQoKSwNCiAgICAgICAgciA9IG4uYXR0cigiZGF0YS1ldC1tYXgtaGVpZ2h0Iik7DQogICAgICBpZiAocikgdmFyIGkgPSByOw0KICAgICAgZWxzZSBpID0gMjQwOw0KICAgICAgbyA8IDI0MCB8fA0KICAgICAgICBuDQogICAgICAgICAgLmFkZENsYXNzKCJsb25nIikNCiAgICAgICAgICAuYXR0cigiZGF0YS1vcmlnaW4taGVpZ2h0Iiwgbi5oZWlnaHQoKSkNCiAgICAgICAgICAuaGVpZ2h0KGkpDQogICAgICAgICAgLmFwcGVuZCgNCiAgICAgICAgICAgICQoDQogICAgICAgICAgICAgICcgICAgICAgPGRpdiBjbGFzcz0icmVhZC1tb3JlIiBhcmlhLWxhYmVsPSJSZWFkIG1vcmUiPiAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIj4gICAgICAgICAgIDxpIGNsYXNzPSJpY29uIGljb24tY2hldnJvbi1kb3duIj48L2k+ICAgICAgICAgICA8aSBjbGFzcz0iaWNvbiBpY29uLWNoZXZyb24tdXAiPjwvaT4gICAgICAgICA8L2J1dHRvbj4gICAgICAgPC9kaXY+ICAgICAgICcNCiAgICAgICAgICAgICkuY2xpY2soZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIHZhciBlID0gJCh0aGlzKS5wYXJlbnQoKSwNCiAgICAgICAgICAgICAgICB0ID0gZS5hdHRyKCJkYXRhLW9yaWdpbi1oZWlnaHQiKTsNCiAgICAgICAgICAgICAgZS5oYXNDbGFzcygiZXQtZXhwYW5kZWQiKQ0KICAgICAgICAgICAgICAgID8gZS5oZWlnaHQoaSkucmVtb3ZlQ2xhc3MoImV0LWV4cGFuZGVkIikNCiAgICAgICAgICAgICAgICA6IGUuaGVpZ2h0KHQpLmFkZENsYXNzKCJldC1leHBhbmRlZCIpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICApOw0KICAgIH0NCiAgfSksDQogICh3aW5kb3cucHJlcGFyZVRodW1icyA9IGZ1bmN0aW9uKGkpIHsNCiAgICAkKCIuYnV0dG9uLXRodW1icy11cCwgLmJ1dHRvbi10aHVtYnMtZG93biIpLmNsaWNrKGZ1bmN0aW9uKGUpIHsNCiAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQuaXNUcnVzdGVkKSB7DQogICAgICAgIHZhciB0ID0gJCh0aGlzKSwNCiAgICAgICAgICBhID0gdC5wYXJlbnQoKSwNCiAgICAgICAgICBuID0gdC5oYXNDbGFzcygiYnV0dG9uLXRodW1icy11cCIpLA0KICAgICAgICAgIG8gPSB0LmRhdGEoImlkIiksDQogICAgICAgICAgciA9IGkgKyAiLyIgKyBvOw0KICAgICAgICBuIHx8IChyICs9ICI/bGlrZT0wIiksDQogICAgICAgICAgJC5wb3N0KHIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICJkZWxldGUiID09IGUucmVzdWx0DQogICAgICAgICAgICAgID8gYS5yZW1vdmVDbGFzcygicHJlc3NlZCIpDQogICAgICAgICAgICAgIDogKGEuYWRkQ2xhc3MoInByZXNzZWQiKSwNCiAgICAgICAgICAgICAgICBhLmZpbmQoImJ1dHRvbiIpLnJlbW92ZUNsYXNzKCJvbiIpLA0KICAgICAgICAgICAgICAgIHQuYWRkQ2xhc3MoIm9uIikpOw0KICAgICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0pOw0KICB9KSwNCiAgKHdpbmRvdy5wcmVwYXJlU2VhcmNoID0gZnVuY3Rpb24obikgew0KICAgIHZhciBlID0gbi5kYXRhKCJyZW1vdGUtdXJsIiksDQogICAgICB0ID0gbmV3IEJsb29kaG91bmQoew0KICAgICAgICBkYXR1bVRva2VuaXplcjogQmxvb2Rob3VuZC50b2tlbml6ZXJzLndoaXRlc3BhY2UsDQogICAgICAgIHF1ZXJ5VG9rZW5pemVyOiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZSwNCiAgICAgICAgcmVtb3RlOiB7IHVybDogZSArICI/cT0lUVVFUlkiLCB3aWxkY2FyZDogIiVRVUVSWSIgfQ0KICAgICAgfSk7DQogICAgbi50eXBlYWhlYWQoDQogICAgICB7IGhpbnQ6ICEwLCBoaWdobGlnaHQ6ICEwLCBtaW5MZW5ndGg6IDIgfSwNCiAgICAgIHsNCiAgICAgICAgc291cmNlOiB0LA0KICAgICAgICBkaXNwbGF5OiAibmFtZSIsDQogICAgICAgIHRlbXBsYXRlczogew0KICAgICAgICAgIHN1Z2dlc3Rpb246IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAgICc8ZGl2PjxzcGFuIGNsYXNzPSJzdWdnZXN0aW9uLW5hbWUiPicgKw0KICAgICAgICAgICAgICBlLm5hbWUgKw0KICAgICAgICAgICAgICAnPC9zcGFuPjxzcGFuIGNsYXNzPSJzdWdnZXN0aW9uLWNvdW50Ij4oJyArDQogICAgICAgICAgICAgIGUuY291bnQgKw0KICAgICAgICAgICAgICAiKTwvc3Bhbj48L2Rpdj4iDQogICAgICAgICAgICApOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICksDQogICAgICBuLmJpbmQoInR5cGVhaGVhZDpzZWxlY3QiLCBmdW5jdGlvbihlLCB0KSB7DQogICAgICAgIHZhciBhID0gdC5uYW1lOw0KICAgICAgICAkLmFqYXgoew0KICAgICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICAgIHVybDogIi9sb2cvc2VhcmNoIiwNCiAgICAgICAgICBkYXRhOiB7IHF1ZXJ5OiBhLCBzdWdnZXN0ZWQ6IDEgfQ0KICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gIi9zZXJ2ZXJzL3RhZy8iICsgYTsNCiAgICAgICAgfSk7DQogICAgICB9KSwNCiAgICAgICQoIi5mb3JtLXNlYXJjaCIpLnN1Ym1pdChmdW5jdGlvbihlKSB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKSwgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsNCiAgICAgICAgdmFyIHQgPSBuLnZhbCgpLA0KICAgICAgICAgIGEgPSB0aGlzOw0KICAgICAgICAkLmFqYXgoeyBtZXRob2Q6ICJQT1NUIiwgdXJsOiAiL2xvZy9zZWFyY2giLCBkYXRhOiB7IHF1ZXJ5OiB0IH0gfSkuZG9uZSgNCiAgICAgICAgICBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICBhLnN1Ym1pdCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgKTsNCiAgICAgIH0pOw0KICB9KSwNCiAgKHdpbmRvdy5wcmVwYXJlU2hhcmVCdXR0b25zID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIHQgPSAkKCIuc2hhcmUtYnV0dG9ucyIpOw0KICAgICQoZG9jdW1lbnQpLnNjcm9sbChmdW5jdGlvbigpIHsNCiAgICAgICEoZnVuY3Rpb24oZSkgew0KICAgICAgICAxMjAgPCAkKGUpLnNjcm9sbFRvcCgpDQogICAgICAgICAgPyB0LmFkZENsYXNzKCJzY3JvbGxlZCIpDQogICAgICAgICAgOiB0LnJlbW92ZUNsYXNzKCJzY3JvbGxlZCIpOw0KICAgICAgfSkodGhpcyk7DQogICAgfSk7DQogIH0pLA0KICAod2luZG93LnByZXBhcmVCdW1wQnV0dG9uID0gZnVuY3Rpb24oaSwgcykgew0KICAgIGZ1bmN0aW9uIGQoZSwgdCkgew0KICAgICAgdmFyIGEgPSBNYXRoLmZsb29yKChlICUgODY0MDApIC8gMzYwMCksDQogICAgICAgIG4gPSBNYXRoLmZsb29yKChlICUgMzYwMCkgLyA2MCksDQogICAgICAgIG8gPSBNYXRoLmZsb29yKGUgJSA2MCk7DQogICAgICAoYSA9IGEgPCAxMCA/ICIwIiArIGEgOiBhKSwNCiAgICAgICAgKG4gPSBuIDwgMTAgPyAiMCIgKyBuIDogbiksDQogICAgICAgIChvID0gbyA8IDEwID8gIjAiICsgbyA6IG8pLA0KICAgICAgICB0LnRleHQoYSArICI6IiArIG4gKyAiOiIgKyBvKTsNCiAgICB9DQogICAgJCgiLmJ1dHRvbi1idW1wIikuZWFjaChmdW5jdGlvbihlLCB0KSB7DQogICAgICB2YXIgYSA9ICh0ID0gJCh0KSkuYXR0cigiZGF0YS1yZW1haW5pbmciKTsNCiAgICAgIGlmIChhKSB7DQogICAgICAgIHZhciBuID0gdC5maW5kKCIudGV4dCIpLA0KICAgICAgICAgIG8gPSBuLmF0dHIoImRhdGEtb3JpZ2luLXRleHQiKTsNCiAgICAgICAgdC5hdHRyKCJkaXNhYmxlZCIsICEwKSwgZChhLCBuKTsNCiAgICAgICAgdmFyIHIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsNCiAgICAgICAgICBkKChhIC09IDEpLCBuKSwNCiAgICAgICAgICAgIGEgPD0gMCAmJiAodC5hdHRyKCJkaXNhYmxlZCIsICExKSwgbi50ZXh0KG8pLCBjbGVhckludGVydmFsKHIpKTsNCiAgICAgICAgfSwgMWUzKTsNCiAgICAgIH0NCiAgICAgIHQuY2xpY2soZnVuY3Rpb24oZSkgew0KICAgICAgICBpZiAoKGUucHJldmVudERlZmF1bHQoKSwgdHJ1ZSkpIHsNCiAgICAgICAgICB2YXIgbiA9ICQodGhpcyk7DQogICAgICAgICAgZ3JlY2FwdGNoYS5leGVjdXRlKGksIHsgYWN0aW9uOiAic2VydmVyL2J1bXAiIH0pLnRoZW4oZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgdmFyIHQgPSBuLmF0dHIoImhyZWYiKSwNCiAgICAgICAgICAgICAgYSA9IHQgKyB0LnN1YnN0cmluZygwLCB0LmluZGV4T2YoIj8iKSkgKyAiPyIgKyBzICsgIj0iICsgZTsNCiAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSBhOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9KTsNCiAgfSksDQogICh3aW5kb3cubG9nSm9pbiA9IGZ1bmN0aW9uKGUpIHsNCiAgICB2YXIgdCA9IHt9Ow0KICAgIHQgPQ0KICAgICAgdm9pZCAwICE9PSB3aW5kb3cuZGlzYm9hcmQuam9pbkxvZ1BhcmFtcw0KICAgICAgICA/IHdpbmRvdy5kaXNib2FyZC5qb2luTG9nUGFyYW1zDQogICAgICAgIDogeyBwYWdlOiBudWxsLCBmcm9tOiBudWxsLCBrZXl3b3JkOiBudWxsIH07DQogICAgdmFyIGEgPSBlLmF0dHIoImRhdGEtaWQiKSwNCiAgICAgIG4gPSBlLmF0dHIoInJhbmsiKSwNCiAgICAgIG8gPSB0LnBhZ2UsDQogICAgICByID0gdC5mcm9tLA0KICAgICAgaSA9IHQua2V5d29yZCwNCiAgICAgIHMgPSB7DQogICAgICAgIHNlcnZlcl9pZDogYSwNCiAgICAgICAgcGF0aDogZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUsDQogICAgICAgIHBhcmFtczogZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoLA0KICAgICAgICByYW5rOiBuLA0KICAgICAgICBwYWdlOiBvLA0KICAgICAgICBmcm9tOiByLA0KICAgICAgICBrZXl3b3JkOiBpDQogICAgICB9Ow0KICAgICQuYWpheCh7IG1ldGhvZDogIlBPU1QiLCB1cmw6ICIvbG9nL2pvaW4iLCBkYXRhOiBzIH0pOw0KICB9KSwNCiAgKHdpbmRvdy5leGVjQ29weSA9IGZ1bmN0aW9uKGUpIHsNCiAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgIHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicHJlIikpLnRleHRDb250ZW50ID0gZTsNCiAgICB2YXIgYSA9IHQuc3R5bGU7DQogICAgKGEucG9zaXRpb24gPSAiZml4ZWQiKSwNCiAgICAgIChhLmxlZnQgPSAiLTEwMCUiKSwNCiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodCksDQogICAgICBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5zZWxlY3RBbGxDaGlsZHJlbih0KTsNCiAgICB2YXIgbiA9IGRvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iik7DQogICAgcmV0dXJuIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodCksIG47DQogIH0pOw0KIShmdW5jdGlvbihlLCB0KSB7DQogICJvYmplY3QiID09IHR5cGVvZiBleHBvcnRzICYmICJvYmplY3QiID09IHR5cGVvZiBtb2R1bGUNCiAgICA/IChtb2R1bGUuZXhwb3J0cyA9IHQoKSkNCiAgICA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kDQogICAgPyBkZWZpbmUoW10sIHQpDQogICAgOiAib2JqZWN0IiA9PSB0eXBlb2YgZXhwb3J0cw0KICAgID8gKGV4cG9ydHMubm90aWUgPSB0KCkpDQogICAgOiAoZS5ub3RpZSA9IHQoKSk7DQp9KSh0aGlzLCBmdW5jdGlvbigpIHsNCiAgcmV0dXJuICgNCiAgICAoYSA9IHt9KSwNCiAgICAocy5tID0gbiA9IFsNCiAgICAgIGZ1bmN0aW9uKGUsIHQpIHsNCiAgICAgICAgZS5leHBvcnRzID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICBlLndlYnBhY2tQb2x5ZmlsbCB8fA0KICAgICAgICAgICAgICAoKGUuZGVwcmVjYXRlID0gZnVuY3Rpb24oKSB7fSksDQogICAgICAgICAgICAgIChlLnBhdGhzID0gW10pLA0KICAgICAgICAgICAgICBlLmNoaWxkcmVuIHx8IChlLmNoaWxkcmVuID0gW10pLA0KICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgImxvYWRlZCIsIHsNCiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMCwNCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGUubDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgImlkIiwgew0KICAgICAgICAgICAgICAgIGVudW1lcmFibGU6ICEwLA0KICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gZS5pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgIChlLndlYnBhY2tQb2x5ZmlsbCA9IDEpKSwNCiAgICAgICAgICAgIGUNCiAgICAgICAgICApOw0KICAgICAgICB9Ow0KICAgICAgfSwNCiAgICAgIGZ1bmN0aW9uKGUsIGksIHQpIHsNCiAgICAgICAgInVzZSBzdHJpY3QiOw0KICAgICAgICAoZnVuY3Rpb24oZSkgew0KICAgICAgICAgIHZhciB0LA0KICAgICAgICAgICAgbiwNCiAgICAgICAgICAgIHMsDQogICAgICAgICAgICBhLA0KICAgICAgICAgICAgYiA9DQogICAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yDQogICAgICAgICAgICAgICAgPyBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgJiYNCiAgICAgICAgICAgICAgICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYNCiAgICAgICAgICAgICAgICAgICAgICBlLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYNCiAgICAgICAgICAgICAgICAgICAgICBlICE9PSBTeW1ib2wucHJvdG90eXBlDQogICAgICAgICAgICAgICAgICAgICAgPyAic3ltYm9sIg0KICAgICAgICAgICAgICAgICAgICAgIDogdHlwZW9mIGU7DQogICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgIChhID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgICAoYSA9IHt9KSwNCiAgICAgICAgICAgICAgKHMubSA9IG4gPSBbDQogICAgICAgICAgICAgICAgZnVuY3Rpb24oZSwgdCwgbikgew0KICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7DQogICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGUsIDApOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHAodCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGUsIDFlMyAqIHQpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGooKSB7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBmdW5jdGlvbiBOKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgICAgICAgICAgICJub3RpZS0iICsNCiAgICAgICAgICAgICAgICAgICAgICAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKA0KICAgICAgICAgICAgICAgICAgICAgICAgL1t4eV0vZywNCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSAoMTYgKiBNYXRoLnJhbmRvbSgpKSB8IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoIngiID09PSBlID8gdCA6ICgzICYgdCkgfCA4KS50b1N0cmluZygxNik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYSgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICAgICAgICAgICAgICBVLnRyYW5zaXRpb25TZWxlY3RvciArDQogICAgICAgICAgICAgICAgICAgICAgIiAiICsNCiAgICAgICAgICAgICAgICAgICAgICBVLnRyYW5zaXRpb25EdXJhdGlvbiArDQogICAgICAgICAgICAgICAgICAgICAgInMgIiArDQogICAgICAgICAgICAgICAgICAgICAgVS50cmFuc2l0aW9uQ3VydmUNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFAoZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTMgPT09IGUua2V5Q29kZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEYoZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjcgPT09IGUua2V5Q29kZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFkoZSwgdCkgew0KICAgICAgICAgICAgICAgICAgICBlLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmNvbnRhaW5lciksDQogICAgICAgICAgICAgICAgICAgICAgKGUuc3R5bGVbdF0gPSAiLTEwMDAwcHgiKSwNCiAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGUpLA0KICAgICAgICAgICAgICAgICAgICAgIChlLnN0eWxlW3RdID0gIi0iICsgZS5vZmZzZXRIZWlnaHQgKyAicHgiKSwNCiAgICAgICAgICAgICAgICAgICAgICBlLmxpc3RlbmVyICYmDQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGUubGlzdGVuZXIpLA0KICAgICAgICAgICAgICAgICAgICAgIHMoKS50aGVuKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgKGUuc3R5bGUudHJhbnNpdGlvbiA9IGEoKSksIChlLnN0eWxlW3RdID0gMCk7DQogICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBmdW5jdGlvbiBfKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKTsNCiAgICAgICAgICAgICAgICAgICAgbiAmJg0KICAgICAgICAgICAgICAgICAgICAgICgobi5zdHlsZVt0XSA9ICItIiArIG4ub2Zmc2V0SGVpZ2h0ICsgInB4IiksDQogICAgICAgICAgICAgICAgICAgICAgbi5saXN0ZW5lciAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBuLmxpc3RlbmVyKSwNCiAgICAgICAgICAgICAgICAgICAgICBwKFUudHJhbnNpdGlvbkR1cmF0aW9uKS50aGVuKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbi5wYXJlbnROb2RlICYmIG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKTsNCiAgICAgICAgICAgICAgICAgICAgICB9KSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBmdW5jdGlvbiB6KGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgKG4uaWQgPSBVLmlkcy5vdmVybGF5KSwNCiAgICAgICAgICAgICAgICAgICAgICBuLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLm92ZXJsYXkpLA0KICAgICAgICAgICAgICAgICAgICAgIG4uY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYmFja2dyb3VuZE92ZXJsYXkpLA0KICAgICAgICAgICAgICAgICAgICAgIChuLnN0eWxlLm9wYWNpdHkgPSAwKSwNCiAgICAgICAgICAgICAgICAgICAgICBlICYmDQogICAgICAgICAgICAgICAgICAgICAgICBVLm92ZXJsYXlDbGlja0Rpc21pc3MgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIChuLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgXyhlLmlkLCB0KSwgQigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKSwNCiAgICAgICAgICAgICAgICAgICAgICBzKCkudGhlbihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIChuLnN0eWxlLnRyYW5zaXRpb24gPSBhKCkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAobi5zdHlsZS5vcGFjaXR5ID0gVS5vdmVybGF5T3BhY2l0eSk7DQogICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpKGUsIHQsIG4pIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBlLnRleHQsDQogICAgICAgICAgICAgICAgICAgICAgYSA9IGUuc3VibWl0VGV4dCwNCiAgICAgICAgICAgICAgICAgICAgICBpID0gdm9pZCAwID09PSBhID8gIlN1Ym1pdCIgOiBhLA0KICAgICAgICAgICAgICAgICAgICAgIGMgPSBlLmNhbmNlbFRleHQsDQogICAgICAgICAgICAgICAgICAgICAgbyA9IHZvaWQgMCA9PT0gYyA/ICJDYW5jZWwiIDogYywNCiAgICAgICAgICAgICAgICAgICAgICByID0gZS5zdWJtaXRDYWxsYmFjaywNCiAgICAgICAgICAgICAgICAgICAgICBsID0gZS5jYW5jZWxDYWxsYmFjaywNCiAgICAgICAgICAgICAgICAgICAgICBkID0gZS5wb3NpdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICB1ID0gdm9pZCAwID09PSBkID8gVS5wb3NpdGlvbnMuaW5wdXQgfHwgdS50b3AgOiBkLA0KICAgICAgICAgICAgICAgICAgICAgIHAgPSAoZnVuY3Rpb24oZSwgdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSB7fTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHMgaW4gZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgMCA8PSB0LmluZGV4T2YocykgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHMpICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobltzXSA9IGVbc10pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuOw0KICAgICAgICAgICAgICAgICAgICAgIH0pKGUsIFsNCiAgICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJzdWJtaXRUZXh0IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJjYW5jZWxUZXh0IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJzdWJtaXRDYWxsYmFjayIsDQogICAgICAgICAgICAgICAgICAgICAgICAiY2FuY2VsQ2FsbGJhY2siLA0KICAgICAgICAgICAgICAgICAgICAgICAgInBvc2l0aW9uIg0KICAgICAgICAgICAgICAgICAgICAgIF0pOw0KICAgICAgICAgICAgICAgICAgICBqKCksIEooKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICBtID0gTigpOw0KICAgICAgICAgICAgICAgICAgICBmLmlkID0gbTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgdi5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy50ZXh0Ym94KSwNCiAgICAgICAgICAgICAgICAgICAgICB2LmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJhY2tncm91bmRJbmZvKSwNCiAgICAgICAgICAgICAgICAgICAgICAodi5pbm5lckhUTUwgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9IicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgVS5jbGFzc2VzLnRleHRib3hJbm5lciArDQogICAgICAgICAgICAgICAgICAgICAgICAnIj4nICsNCiAgICAgICAgICAgICAgICAgICAgICAgIHMgKw0KICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgICAgICAgICAgICAgIGIuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuaW5wdXRGaWVsZCksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoDQogICAgICAgICAgICAgICAgICAgICAgICAiYXV0b2NhcGl0YWxpemUiLA0KICAgICAgICAgICAgICAgICAgICAgICAgcC5hdXRvY2FwaXRhbGl6ZSB8fCAibm9uZSINCiAgICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAgIGIuc2V0QXR0cmlidXRlKCJhdXRvY29tcGxldGUiLCBwLmF1dG9jb21wbGV0ZSB8fCAib2ZmIiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoImF1dG9jb3JyZWN0IiwgcC5hdXRvY29ycmVjdCB8fCAib2ZmIiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoImF1dG9mb2N1cyIsIHAuYXV0b2ZvY3VzIHx8ICJ0cnVlIiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoImlucHV0bW9kZSIsIHAuaW5wdXRtb2RlIHx8ICJ2ZXJiYXRpbSIpLA0KICAgICAgICAgICAgICAgICAgICAgIGIuc2V0QXR0cmlidXRlKCJtYXgiLCBwLm1heCB8fCAiIiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoIm1heGxlbmd0aCIsIHAubWF4bGVuZ3RoIHx8ICIiKSwNCiAgICAgICAgICAgICAgICAgICAgICBiLnNldEF0dHJpYnV0ZSgibWluIiwgcC5taW4gfHwgIiIpLA0KICAgICAgICAgICAgICAgICAgICAgIGIuc2V0QXR0cmlidXRlKCJtaW5sZW5ndGgiLCBwLm1pbmxlbmd0aCB8fCAiIiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoInBsYWNlaG9sZGVyIiwgcC5wbGFjZWhvbGRlciB8fCAiIiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoInNwZWxsY2hlY2siLCBwLnNwZWxsY2hlY2sgfHwgImRlZmF1bHQiKSwNCiAgICAgICAgICAgICAgICAgICAgICBiLnNldEF0dHJpYnV0ZSgic3RlcCIsIHAuc3RlcCB8fCAiYW55IiksDQogICAgICAgICAgICAgICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoInR5cGUiLCBwLnR5cGUgfHwgInRleHQiKSwNCiAgICAgICAgICAgICAgICAgICAgICAoYi52YWx1ZSA9IHAudmFsdWUgfHwgIiIpLA0KICAgICAgICAgICAgICAgICAgICAgIHAuYWxsb3dlZCAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgKGIub25pbnB1dCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHZvaWQgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocC5hbGxvd2VkKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9ICIiLCBuID0gcC5hbGxvd2VkLCBzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPCBuLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhbiIgPT09IG5bc10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAodCArPSAiMC05YS16QS1aIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAiYSIgPT09IG5bc10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAodCArPSAiYS16QS1aIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAibiIgPT09IG5bc10gJiYgKHQgKz0gIjAtOSIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicyIgPT09IG5bc10gJiYgKHQgKz0gIiAiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gbmV3IFJlZ0V4cCgiW14iICsgdCArICJdIiwgImciKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlICJvYmplY3QiID09PSBMKHAuYWxsb3dlZCkgJiYgKGUgPSBwLmFsbG93ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBiLnZhbHVlID0gYi52YWx1ZS5yZXBsYWNlKGUsICIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICB4LmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJ1dHRvbiksDQogICAgICAgICAgICAgICAgICAgICAgeC5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5lbGVtZW50SGFsZiksDQogICAgICAgICAgICAgICAgICAgICAgeC5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kU3VjY2VzcyksDQogICAgICAgICAgICAgICAgICAgICAgKHguaW5uZXJIVE1MID0gaSksDQogICAgICAgICAgICAgICAgICAgICAgKHgub25jbGljayA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgXyhtLCB1KSwgQigpLCByID8gcihiLnZhbHVlKSA6IHQgJiYgdChiLnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgeS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5idXR0b24pLA0KICAgICAgICAgICAgICAgICAgICAgIHkuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudEhhbGYpLA0KICAgICAgICAgICAgICAgICAgICAgIHkuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYmFja2dyb3VuZEVycm9yKSwNCiAgICAgICAgICAgICAgICAgICAgICAoeS5pbm5lckhUTUwgPSBvKSwNCiAgICAgICAgICAgICAgICAgICAgICAoeS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBfKG0sIHUpLCBCKCksIGwgPyBsKGIudmFsdWUpIDogbiAmJiBuKGIudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICAgIGYuYXBwZW5kQ2hpbGQodiksDQogICAgICAgICAgICAgICAgICAgICAgZi5hcHBlbmRDaGlsZChiKSwNCiAgICAgICAgICAgICAgICAgICAgICBmLmFwcGVuZENoaWxkKHgpLA0KICAgICAgICAgICAgICAgICAgICAgIGYuYXBwZW5kQ2hpbGQoeSksDQogICAgICAgICAgICAgICAgICAgICAgKGYubGlzdGVuZXIgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBQKGUpID8geC5jbGljaygpIDogRihlKSAmJiB5LmNsaWNrKCk7DQogICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgWShmLCB1KSwNCiAgICAgICAgICAgICAgICAgICAgICBiLmZvY3VzKCksDQogICAgICAgICAgICAgICAgICAgICAgeihmLCB1KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIHZhciBMID0NCiAgICAgICAgICAgICAgICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYNCiAgICAgICAgICAgICAgICAgICAgICAic3ltYm9sIiA9PT0gYihTeW1ib2wuaXRlcmF0b3IpDQogICAgICAgICAgICAgICAgICAgICAgICA/IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBlID8gInVuZGVmaW5lZCIgOiBiKGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgIT09IFN5bWJvbC5wcm90b3R5cGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gInN5bWJvbCINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdm9pZCAwID09PSBlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICJ1bmRlZmluZWQiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGIoZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGMgPQ0KICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24gfHwNCiAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMTsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGFyZ3VtZW50c1t0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcyBpbiBuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLCBzKSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVbc10gPSBuW3NdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlOw0KICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIG8gPSAidG9wIiwNCiAgICAgICAgICAgICAgICAgICAgVSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydFRpbWU6IDMsDQogICAgICAgICAgICAgICAgICAgICAgZGF0ZU1vbnRoczogWw0KICAgICAgICAgICAgICAgICAgICAgICAgIkphbnVhcnkiLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkZlYnJ1YXJ5IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJNYXJjaCIsDQogICAgICAgICAgICAgICAgICAgICAgICAiQXByaWwiLA0KICAgICAgICAgICAgICAgICAgICAgICAgIk1heSIsDQogICAgICAgICAgICAgICAgICAgICAgICAiSnVuZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAiSnVseSIsDQogICAgICAgICAgICAgICAgICAgICAgICAiQXVndXN0IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJTZXB0ZW1iZXIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgIk9jdG9iZXIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgIk5vdmVtYmVyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJEZWNlbWJlciINCiAgICAgICAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlDbGlja0Rpc21pc3M6ICEwLA0KICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlPcGFjaXR5OiAwLjc1LA0KICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25DdXJ2ZTogImVhc2UiLA0KICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25EdXJhdGlvbjogMC4zLA0KICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25TZWxlY3RvcjogImFsbCIsDQogICAgICAgICAgICAgICAgICAgICAgY2xhc3Nlczogew0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAibm90aWUtY29udGFpbmVyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRib3g6ICJub3RpZS10ZXh0Ym94IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRib3hJbm5lcjogIm5vdGllLXRleHRib3gtaW5uZXIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiAibm90aWUtYnV0dG9uIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6ICJub3RpZS1lbGVtZW50IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRIYWxmOiAibm90aWUtZWxlbWVudC1oYWxmIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUaGlyZDogIm5vdGllLWVsZW1lbnQtdGhpcmQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheTogIm5vdGllLW92ZXJsYXkiLA0KICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFN1Y2Nlc3M6ICJub3RpZS1iYWNrZ3JvdW5kLXN1Y2Nlc3MiLA0KICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFdhcm5pbmc6ICJub3RpZS1iYWNrZ3JvdW5kLXdhcm5pbmciLA0KICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEVycm9yOiAibm90aWUtYmFja2dyb3VuZC1lcnJvciIsDQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW5mbzogIm5vdGllLWJhY2tncm91bmQtaW5mbyIsDQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kTmV1dHJhbDogIm5vdGllLWJhY2tncm91bmQtbmV1dHJhbCIsDQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kT3ZlcmxheTogIm5vdGllLWJhY2tncm91bmQtb3ZlcmxheSIsDQogICAgICAgICAgICAgICAgICAgICAgICBhbGVydDogIm5vdGllLWFsZXJ0IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0RmllbGQ6ICJub3RpZS1pbnB1dC1maWVsZCIsDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RDaG9pY2VSZXBlYXRlZDogIm5vdGllLXNlbGVjdC1jaG9pY2UtcmVwZWF0ZWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZVNlbGVjdG9ySW5uZXI6ICJub3RpZS1kYXRlLXNlbGVjdG9yLWlubmVyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVTZWxlY3RvclVwOiAibm90aWUtZGF0ZS1zZWxlY3Rvci11cCINCiAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgIGlkczogeyBvdmVybGF5OiAibm90aWUtb3ZlcmxheSIgfSwNCiAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0OiBvLA0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2U6IG8sDQogICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtOiBvLA0KICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IG8sDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6ICJib3R0b20iLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgciA9ICh0LnNldE9wdGlvbnMgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgVSA9IGMoe30sIFUsIGUsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IGMoe30sIFUuY2xhc3NlcywgZS5jbGFzc2VzKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkczogYyh7fSwgVS5pZHMsIGUuaWRzKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uczogYyh7fSwgVS5wb3NpdGlvbnMsIGUucG9zaXRpb25zKQ0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAxOiBVLmNsYXNzZXMuYmFja2dyb3VuZFN1Y2Nlc3MsDQogICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogVS5jbGFzc2VzLmJhY2tncm91bmRTdWNjZXNzLA0KICAgICAgICAgICAgICAgICAgICAgIDI6IFUuY2xhc3Nlcy5iYWNrZ3JvdW5kV2FybmluZywNCiAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nOiBVLmNsYXNzZXMuYmFja2dyb3VuZFdhcm5pbmcsDQogICAgICAgICAgICAgICAgICAgICAgMzogVS5jbGFzc2VzLmJhY2tncm91bmRFcnJvciwNCiAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogVS5jbGFzc2VzLmJhY2tncm91bmRFcnJvciwNCiAgICAgICAgICAgICAgICAgICAgICA0OiBVLmNsYXNzZXMuYmFja2dyb3VuZEluZm8sDQogICAgICAgICAgICAgICAgICAgICAgaW5mbzogVS5jbGFzc2VzLmJhY2tncm91bmRJbmZvLA0KICAgICAgICAgICAgICAgICAgICAgIDU6IFUuY2xhc3Nlcy5iYWNrZ3JvdW5kTmV1dHJhbCwNCiAgICAgICAgICAgICAgICAgICAgICBuZXV0cmFsOiBVLmNsYXNzZXMuYmFja2dyb3VuZE5ldXRyYWwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgQiA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoVS5pZHMub3ZlcmxheSk7DQogICAgICAgICAgICAgICAgICAgICAgKGUuc3R5bGUub3BhY2l0eSA9IDApLA0KICAgICAgICAgICAgICAgICAgICAgICAgcChVLnRyYW5zaXRpb25EdXJhdGlvbikudGhlbihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wYXJlbnROb2RlICYmIGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBKID0gKHQuaGlkZUFsZXJ0cyA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoVS5jbGFzc2VzLmFsZXJ0KTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAodC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IHRbbl07DQogICAgICAgICAgICAgICAgICAgICAgICAgIF8ocy5pZCwgcy5wb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgIHAoVS50cmFuc2l0aW9uRHVyYXRpb24pLnRoZW4oZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgbCA9ICh0LmFsZXJ0ID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gZS50eXBlLA0KICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHZvaWQgMCA9PT0gdCA/IDQgOiB0LA0KICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGUudGV4dCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBlLnRpbWUsDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gdm9pZCAwID09PSBhID8gVS5hbGVydFRpbWUgOiBhLA0KICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGUuc3RheSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSB2b2lkIDAgIT09IGMgJiYgYywNCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBlLnBvc2l0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHZvaWQgMCA9PT0gciA/IFUucG9zaXRpb25zLmFsZXJ0IHx8IGwudG9wIDogcjsNCiAgICAgICAgICAgICAgICAgICAgICBqKCksIEooKTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgdSA9IE4oKTsNCiAgICAgICAgICAgICAgICAgICAgICAoZC5pZCA9IHUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKGQucG9zaXRpb24gPSBsKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGQuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMudGV4dGJveCksDQogICAgICAgICAgICAgICAgICAgICAgICBkLmNsYXNzTGlzdC5hZGQobVtuXSksDQogICAgICAgICAgICAgICAgICAgICAgICBkLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmFsZXJ0KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChkLmlubmVySFRNTCA9DQogICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSInICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgVS5jbGFzc2VzLnRleHRib3hJbm5lciArDQogICAgICAgICAgICAgICAgICAgICAgICAgICciPicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICBzICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKGQub25jbGljayA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXyh1LCBsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgKGQubGlzdGVuZXIgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIChQKGUpIHx8IEYoZSkpICYmIEooKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgWShkLCBsKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGkgJiYgaSA8IDEgJiYgKGkgPSAxKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICFvICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgIGkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcChpKS50aGVuKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfKHUsIGwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgIGQgPSAodC5mb3JjZSA9IGZ1bmN0aW9uKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGUudHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSB2b2lkIDAgPT09IG4gPyA1IDogbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBlLnRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gZS5idXR0b25UZXh0LA0KICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHZvaWQgMCA9PT0gaSA/ICJPSyIgOiBpLA0KICAgICAgICAgICAgICAgICAgICAgICAgbyA9IGUuY2FsbGJhY2ssDQogICAgICAgICAgICAgICAgICAgICAgICByID0gZS5wb3NpdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB2b2lkIDAgPT09IHIgPyBVLnBvc2l0aW9ucy5mb3JjZSB8fCBsLnRvcCA6IHI7DQogICAgICAgICAgICAgICAgICAgICAgaigpLCBKKCk7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBOKCk7DQogICAgICAgICAgICAgICAgICAgICAgZC5pZCA9IHU7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgICBwLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLnRleHRib3gpLA0KICAgICAgICAgICAgICAgICAgICAgICAgcC5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kSW5mbyksDQogICAgICAgICAgICAgICAgICAgICAgICAocC5pbm5lckhUTUwgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgIFUuY2xhc3Nlcy50ZXh0Ym94SW5uZXIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAnIj4nICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYSArDQogICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iKTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIGYuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYnV0dG9uKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGYuY2xhc3NMaXN0LmFkZChtW3NdKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChmLmlubmVySFRNTCA9IGMpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKGYub25jbGljayA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBfKHUsIGwpLCBCKCksIG8gPyBvKCkgOiB0ICYmIHQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgZC5hcHBlbmRDaGlsZChwKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGQuYXBwZW5kQ2hpbGQoZiksDQogICAgICAgICAgICAgICAgICAgICAgICAoZC5saXN0ZW5lciA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgUChlKSAmJiBmLmNsaWNrKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFkoZCwgbCksDQogICAgICAgICAgICAgICAgICAgICAgICB6KCk7DQogICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICB1ID0gKHQuY29uZmlybSA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGUudGV4dCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBlLnN1Ym1pdFRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gdm9pZCAwID09PSBhID8gIlllcyIgOiBhLA0KICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGUuY2FuY2VsVGV4dCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSB2b2lkIDAgPT09IGMgPyAiQ2FuY2VsIiA6IGMsDQogICAgICAgICAgICAgICAgICAgICAgICByID0gZS5zdWJtaXRDYWxsYmFjaywNCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBlLmNhbmNlbENhbGxiYWNrLA0KICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGUucG9zaXRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICB1ID0gdm9pZCAwID09PSBkID8gVS5wb3NpdGlvbnMuY29uZmlybSB8fCB1LnRvcCA6IGQ7DQogICAgICAgICAgICAgICAgICAgICAgaigpLCBKKCk7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBOKCk7DQogICAgICAgICAgICAgICAgICAgICAgcC5pZCA9IGY7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgICBtLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLnRleHRib3gpLA0KICAgICAgICAgICAgICAgICAgICAgICAgbS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kSW5mbyksDQogICAgICAgICAgICAgICAgICAgICAgICAobS5pbm5lckhUTUwgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgIFUuY2xhc3Nlcy50ZXh0Ym94SW5uZXIgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAnIj4nICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iKTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIHYuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYnV0dG9uKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHYuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudEhhbGYpLA0KICAgICAgICAgICAgICAgICAgICAgICAgdi5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kU3VjY2VzcyksDQogICAgICAgICAgICAgICAgICAgICAgICAodi5pbm5lckhUTUwgPSBpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICh2Lm9uY2xpY2sgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgXyhmLCB1KSwgQigpLCByID8gcigpIDogdCAmJiB0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIGIuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYnV0dG9uKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGIuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudEhhbGYpLA0KICAgICAgICAgICAgICAgICAgICAgICAgYi5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kRXJyb3IpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKGIuaW5uZXJIVE1MID0gbyksDQogICAgICAgICAgICAgICAgICAgICAgICAoYi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIF8oZiwgdSksIEIoKSwgbCA/IGwoKSA6IG4gJiYgbigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICBwLmFwcGVuZENoaWxkKG0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgcC5hcHBlbmRDaGlsZCh2KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHAuYXBwZW5kQ2hpbGQoYiksDQogICAgICAgICAgICAgICAgICAgICAgICAocC5saXN0ZW5lciA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgUChlKSA/IHYuY2xpY2soKSA6IEYoZSkgJiYgYi5jbGljaygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICBZKHAsIHUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgeihwLCB1KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB0LmlucHV0ID0gaTsNCiAgICAgICAgICAgICAgICAgIHZhciBmID0gKHQuc2VsZWN0ID0gZnVuY3Rpb24oZSwgdCkgew0KICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gZS50ZXh0LA0KICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGUuY2FuY2VsVGV4dCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSB2b2lkIDAgPT09IHMgPyAiQ2FuY2VsIiA6IHMsDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gZS5jYW5jZWxDYWxsYmFjaywNCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBlLmNob2ljZXMsDQogICAgICAgICAgICAgICAgICAgICAgICBjID0gZS5wb3NpdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB2b2lkIDAgPT09IGMgPyBVLnBvc2l0aW9ucy5zZWxlY3QgfHwgbC50b3AgOiBjOw0KICAgICAgICAgICAgICAgICAgICAgIGooKSwgSigpOw0KICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksDQogICAgICAgICAgICAgICAgICAgICAgICB1ID0gTigpOw0KICAgICAgICAgICAgICAgICAgICAgIGQuaWQgPSB1Ow0KICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgICAgICAgby5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy50ZXh0Ym94KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG8uY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYmFja2dyb3VuZEluZm8pLA0KICAgICAgICAgICAgICAgICAgICAgICAgKG8uaW5uZXJIVE1MID0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9IicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICBVLmNsYXNzZXMudGV4dGJveElubmVyICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgJyI+JyArDQogICAgICAgICAgICAgICAgICAgICAgICAgIG4gKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiksDQogICAgICAgICAgICAgICAgICAgICAgICBkLmFwcGVuZENoaWxkKG8pLA0KICAgICAgICAgICAgICAgICAgICAgICAgci5mb3JFYWNoKGZ1bmN0aW9uKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlLnR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHZvaWQgMCA9PT0gbiA/IDEgOiBuLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBlLnRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGUuaGFuZGxlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGMuY2xhc3NMaXN0LmFkZChtW3NdKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJ1dHRvbiksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5zZWxlY3RDaG9pY2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHJbdCArIDFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBvICYmICFvLnR5cGUgJiYgKG8udHlwZSA9IDEpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8udHlwZSA9PT0gcyAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5zZWxlY3RDaG9pY2VSZXBlYXRlZCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGMuaW5uZXJIVE1MID0gYSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGMub25jbGljayA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyh1LCBsKSwgQigpLCBpKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5hcHBlbmRDaGlsZChjKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgICAgICAgcC5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kTmV1dHJhbCksDQogICAgICAgICAgICAgICAgICAgICAgICBwLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJ1dHRvbiksDQogICAgICAgICAgICAgICAgICAgICAgICAocC5pbm5lckhUTUwgPSBhKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChwLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgXyh1LCBsKSwgQigpLCBpID8gaSgpIDogdCAmJiB0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGQuYXBwZW5kQ2hpbGQocCksDQogICAgICAgICAgICAgICAgICAgICAgICAoZC5saXN0ZW5lciA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgRihlKSAmJiBwLmNsaWNrKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFkoZCwgbCksDQogICAgICAgICAgICAgICAgICAgICAgICB6KGQsIGwpOw0KICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgdiA9ICh0LmRhdGUgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBlLnZhbHVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgYSA9IHZvaWQgMCA9PT0gcyA/IG5ldyBEYXRlKCkgOiBzLA0KICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGUuc3VibWl0VGV4dCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB2b2lkIDAgPT09IGkgPyAiT0siIDogaSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBlLmNhbmNlbFRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICByID0gdm9pZCAwID09PSBvID8gIkNhbmNlbCIgOiBvLA0KICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGUuc3VibWl0Q2FsbGJhY2ssDQogICAgICAgICAgICAgICAgICAgICAgICBkID0gZS5jYW5jZWxDYWxsYmFjaywNCiAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBlLnBvc2l0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHZvaWQgMCA9PT0gdSA/IFUucG9zaXRpb25zLmRhdGUgfHwgcC50b3AgOiB1Ow0KICAgICAgICAgICAgICAgICAgICAgIGooKSwgSigpOw0KICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGYoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgKEwuaW5uZXJIVE1MID0gVS5kYXRlTW9udGhzW2UuZ2V0TW9udGgoKV0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAoZy5pbm5lckhUTUwgPSBlLmdldERhdGUoKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIChoLmlubmVySFRNTCA9IGUuZ2V0RnVsbFllYXIoKSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG0oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZihhKTsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBEYXRlKA0KICAgICAgICAgICAgICAgICAgICAgICAgICBhLmdldEZ1bGxZZWFyKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2V0TW9udGgoKSArIGUgKyAxLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAwDQogICAgICAgICAgICAgICAgICAgICAgICApLmdldERhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2V0RGF0ZSgpID4gdCAmJiBhLnNldERhdGUodCksDQogICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2V0TW9udGgoYS5nZXRNb250aCgpICsgZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIGYoYSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGIoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYS5zZXREYXRlKGEuZ2V0RGF0ZSgpICsgZSksIGYoYSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHgoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYS5nZXRGdWxsWWVhcigpICsgZSA8IDANCiAgICAgICAgICAgICAgICAgICAgICAgICAgPyBhLnNldEZ1bGxZZWFyKDApDQogICAgICAgICAgICAgICAgICAgICAgICAgIDogYS5zZXRGdWxsWWVhcihhLmdldEZ1bGxZZWFyKCkgKyBlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZihhKTsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSAiJiM5NjYyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIEwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBOKCk7DQogICAgICAgICAgICAgICAgICAgICAgay5pZCA9IEM7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIEUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgICBFLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJhY2tncm91bmRJbmZvKTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIFQuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZGF0ZVNlbGVjdG9ySW5uZXIpOw0KICAgICAgICAgICAgICAgICAgICAgIHZhciBNID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgICAgICAgTS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5idXR0b24pLA0KICAgICAgICAgICAgICAgICAgICAgICAgTS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5lbGVtZW50VGhpcmQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgTS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5kYXRlU2VsZWN0b3JVcCksDQogICAgICAgICAgICAgICAgICAgICAgICAoTS5pbm5lckhUTUwgPSB5KTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgSCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIEguY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYnV0dG9uKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEguY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudFRoaXJkKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEguY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZGF0ZVNlbGVjdG9yVXApLA0KICAgICAgICAgICAgICAgICAgICAgICAgKEguaW5uZXJIVE1MID0geSk7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIFMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgICBTLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJ1dHRvbiksDQogICAgICAgICAgICAgICAgICAgICAgICBTLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmVsZW1lbnRUaGlyZCksDQogICAgICAgICAgICAgICAgICAgICAgICBTLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmRhdGVTZWxlY3RvclVwKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChTLmlubmVySFRNTCA9IHkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgTC5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5lbGVtZW50KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEwuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudFRoaXJkKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChMLmlubmVySFRNTCA9IFUuZGF0ZU1vbnRoc1thLmdldE1vbnRoKCldKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGcuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudCksDQogICAgICAgICAgICAgICAgICAgICAgICBnLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmVsZW1lbnRUaGlyZCksDQogICAgICAgICAgICAgICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgiY29udGVudEVkaXRhYmxlIiwgITApLA0KICAgICAgICAgICAgICAgICAgICAgICAgZy5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBuZXcgRGF0ZSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2V0RnVsbFllYXIoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2V0TW9udGgoKSArIDEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5nZXREYXRlKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGUudGFyZ2V0LnRleHRDb250ZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXjArLywgIiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW15cZF0vZywgIiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgMik7DQogICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlcihuKSA+IHQgJiYgKG4gPSB0LnRvU3RyaW5nKCkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLnRhcmdldC50ZXh0Q29udGVudCA9IG4pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlcihuKSA8IDEgJiYgKG4gPSAiMSIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2V0RGF0ZShOdW1iZXIobikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICBnLmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCBtKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChnLmlubmVySFRNTCA9IGEuZ2V0RGF0ZSgpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGguY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudCksDQogICAgICAgICAgICAgICAgICAgICAgICBoLmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmVsZW1lbnRUaGlyZCksDQogICAgICAgICAgICAgICAgICAgICAgICBoLnNldEF0dHJpYnV0ZSgiY29udGVudEVkaXRhYmxlIiwgITApLA0KICAgICAgICAgICAgICAgICAgICAgICAgaC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLnRhcmdldC50ZXh0Q29udGVudA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eMCsvLCAiIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW15cZF0vZywgIiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNsaWNlKDAsIDQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAoZS50YXJnZXQudGV4dENvbnRlbnQgPSB0KSwgYS5zZXRGdWxsWWVhcihOdW1iZXIodCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICBoLmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCBtKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChoLmlubmVySFRNTCA9IGEuZ2V0RnVsbFllYXIoKSk7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgICB3LmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJ1dHRvbiksDQogICAgICAgICAgICAgICAgICAgICAgICB3LmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmVsZW1lbnRUaGlyZCksDQogICAgICAgICAgICAgICAgICAgICAgICAody5pbm5lckhUTUwgPSB5KTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgTyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIE8uY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYnV0dG9uKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIE8uY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudFRoaXJkKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChPLmlubmVySFRNTCA9IHkpOw0KICAgICAgICAgICAgICAgICAgICAgIHZhciBBID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgICAgICAgQS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5idXR0b24pLA0KICAgICAgICAgICAgICAgICAgICAgICAgQS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5lbGVtZW50VGhpcmQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKEEuaW5uZXJIVE1MID0geSksDQogICAgICAgICAgICAgICAgICAgICAgICAoTS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2KDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICAoSC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiKDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICAoUy5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4KDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICAody5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2KC0xKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgKE8ub25jbGljayA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYigtMSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChBLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgoLTEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgdmFyIEQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICAgICAgICBELmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmJ1dHRvbiksDQogICAgICAgICAgICAgICAgICAgICAgICBELmNsYXNzTGlzdC5hZGQoVS5jbGFzc2VzLmVsZW1lbnRIYWxmKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEQuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYmFja2dyb3VuZFN1Y2Nlc3MpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKEQuaW5uZXJIVE1MID0gYyksDQogICAgICAgICAgICAgICAgICAgICAgICAoRC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIF8oQywgcCksIEIoKSwgbCA/IGwoYSkgOiB0ICYmIHQoYSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICB2YXIgSSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgICAgICAgIEkuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuYnV0dG9uKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEkuY2xhc3NMaXN0LmFkZChVLmNsYXNzZXMuZWxlbWVudEhhbGYpLA0KICAgICAgICAgICAgICAgICAgICAgICAgSS5jbGFzc0xpc3QuYWRkKFUuY2xhc3Nlcy5iYWNrZ3JvdW5kRXJyb3IpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKEkuaW5uZXJIVE1MID0gciksDQogICAgICAgICAgICAgICAgICAgICAgICAoSS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIF8oQywgcCksIEIoKSwgZCA/IGQoYSkgOiBuICYmIG4oYSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFQuYXBwZW5kQ2hpbGQoTSksDQogICAgICAgICAgICAgICAgICAgICAgICBULmFwcGVuZENoaWxkKEgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgVC5hcHBlbmRDaGlsZChTKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFQuYXBwZW5kQ2hpbGQoTCksDQogICAgICAgICAgICAgICAgICAgICAgICBULmFwcGVuZENoaWxkKGcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgVC5hcHBlbmRDaGlsZChoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFQuYXBwZW5kQ2hpbGQodyksDQogICAgICAgICAgICAgICAgICAgICAgICBULmFwcGVuZENoaWxkKE8pLA0KICAgICAgICAgICAgICAgICAgICAgICAgVC5hcHBlbmRDaGlsZChBKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEUuYXBwZW5kQ2hpbGQoVCksDQogICAgICAgICAgICAgICAgICAgICAgICBrLmFwcGVuZENoaWxkKEUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgay5hcHBlbmRDaGlsZChEKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGsuYXBwZW5kQ2hpbGQoSSksDQogICAgICAgICAgICAgICAgICAgICAgICAoay5saXN0ZW5lciA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgUChlKSA/IEQuY2xpY2soKSA6IEYoZSkgJiYgSS5jbGljaygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgICBZKGssIHApLA0KICAgICAgICAgICAgICAgICAgICAgICAgeihrLCBwKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB0LmRlZmF1bHQgPSB7DQogICAgICAgICAgICAgICAgICAgIGFsZXJ0OiBsLA0KICAgICAgICAgICAgICAgICAgICBmb3JjZTogZCwNCiAgICAgICAgICAgICAgICAgICAgY29uZmlybTogdSwNCiAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGksDQogICAgICAgICAgICAgICAgICAgIHNlbGVjdDogZiwNCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogdiwNCiAgICAgICAgICAgICAgICAgICAgc2V0T3B0aW9uczogciwNCiAgICAgICAgICAgICAgICAgICAgaGlkZUFsZXJ0czogSg0KICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIF0pLA0KICAgICAgICAgICAgICAocy5jID0gYSksDQogICAgICAgICAgICAgIChzLmkgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGU7DQogICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAocy5kID0gZnVuY3Rpb24oZSwgdCwgbikgew0KICAgICAgICAgICAgICAgIHMubyhlLCB0KSB8fA0KICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHQsIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMSwNCiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgICAgICAgICAgIGdldDogbg0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAocy5uID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgIHZhciB0ID0NCiAgICAgICAgICAgICAgICAgIGUgJiYgZS5fX2VzTW9kdWxlDQogICAgICAgICAgICAgICAgICAgID8gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5kZWZhdWx0Ow0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlOw0KICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmV0dXJuIHMuZCh0LCAiYSIsIHQpLCB0Ow0KICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgKHMubyA9IGZ1bmN0aW9uKGUsIHQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpOw0KICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgKHMucCA9ICIiKSwNCiAgICAgICAgICAgICAgcygocy5zID0gMCkpDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgZnVuY3Rpb24gcyhlKSB7DQogICAgICAgICAgICAgIGlmIChhW2VdKSByZXR1cm4gYVtlXS5leHBvcnRzOw0KICAgICAgICAgICAgICB2YXIgdCA9IChhW2VdID0geyBpOiBlLCBsOiAhMSwgZXhwb3J0czoge30gfSk7DQogICAgICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAgICAgbltlXS5jYWxsKHQuZXhwb3J0cywgdCwgdC5leHBvcnRzLCBzKSwgKHQubCA9ICEwKSwgdC5leHBvcnRzDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgbiwgYTsNCiAgICAgICAgICB9KSwNCiAgICAgICAgICAgICJvYmplY3QiID09PSBiKGkpICYmICJvYmplY3QiID09PSBiKGUpDQogICAgICAgICAgICAgID8gKGUuZXhwb3J0cyA9IGEoKSkNCiAgICAgICAgICAgICAgOiAoKG4gPSBbXSksDQogICAgICAgICAgICAgICAgdm9pZCAwID09PQ0KICAgICAgICAgICAgICAgICAgKHMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiAodCA9IGEpID8gdC5hcHBseShpLCBuKSA6IHQpIHx8DQogICAgICAgICAgICAgICAgICAoZS5leHBvcnRzID0gcykpOw0KICAgICAgICB9LmNhbGwoaSwgdCgwKShlKSkpOw0KICAgICAgfQ0KICAgIF0pLA0KICAgIChzLmMgPSBhKSwNCiAgICAocy5pID0gZnVuY3Rpb24oZSkgew0KICAgICAgcmV0dXJuIGU7DQogICAgfSksDQogICAgKHMuZCA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCiAgICAgIHMubyhlLCB0KSB8fA0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdCwgew0KICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITEsDQogICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgZ2V0OiBuDQogICAgICAgIH0pOw0KICAgIH0pLA0KICAgIChzLm4gPSBmdW5jdGlvbihlKSB7DQogICAgICB2YXIgdCA9DQogICAgICAgIGUgJiYgZS5fX2VzTW9kdWxlDQogICAgICAgICAgPyBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGUuZGVmYXVsdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICByZXR1cm4gZTsNCiAgICAgICAgICAgIH07DQogICAgICByZXR1cm4gcy5kKHQsICJhIiwgdCksIHQ7DQogICAgfSksDQogICAgKHMubyA9IGZ1bmN0aW9uKGUsIHQpIHsNCiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCk7DQogICAgfSksDQogICAgKHMucCA9ICIiKSwNCiAgICBzKChzLnMgPSAxKSkNCiAgKTsNCiAgZnVuY3Rpb24gcyhlKSB7DQogICAgaWYgKGFbZV0pIHJldHVybiBhW2VdLmV4cG9ydHM7DQogICAgdmFyIHQgPSAoYVtlXSA9IHsgaTogZSwgbDogITEsIGV4cG9ydHM6IHt9IH0pOw0KICAgIHJldHVybiBuW2VdLmNhbGwodC5leHBvcnRzLCB0LCB0LmV4cG9ydHMsIHMpLCAodC5sID0gITApLCB0LmV4cG9ydHM7DQogIH0NCiAgdmFyIG4sIGE7DQp9KTsNCg=="
      }
  };

chrome.webRequest.onBeforeRequest.addListener(
  redirect,
  {urls:["*://disboard.org/js/app.js*"], types:["script"]},
  ["blocking"]
);